\documentclass{pnp_article}

\externaldocument{../pus/PusExtension}  % Allows cross-references to Def. Doc.
\externaldocument{../um/PusExtensionUM}   	% Allows cross-references to UM

\begin{document}

\SetDocIssue{0.2}
\SetDocRefNumber{PP-IC-PUX-0001}
\SetDocTitle{CORDET Framework - PUS Extension}
\SetDocSubtitle{TM/TC Interface Control Document}
\SetDocAuthor{Alessandro Pasetti}
\SetCheckedBy{n.a.}
\maketitle

\maketitle

\newpage
\tableofcontents
%\newpage
%\listoffigures
%\newpage
%\listoftables

%---------------------------------------------
% Import files with definition of ICD items
%---------------------------------------------
\input{./GeneratedTables/CrPs.tex}
\input{./GeneratedTables/PUSExtensionDatapoolVariables.tex}
\input{./GeneratedTables/PUSExtensionDatapoolParameters.tex}
\input{./GeneratedTables/CrPsTypes.tex}

%==========================================================================================
\section{References}
The documents referenced in this document are listed in table \ref{tab:refdoc}.

\listofreferencedocs{\PxIc}

%==========================================================================================
\section{Introduction}
This document is the interface control document for the telemetry reports and telecommands of the PUS Extension of the CORDET Framework. The PUS Extension of the CORDET Framework is specified in reference [CR-SP]. A partial implementation in C is available and its user manual is in reference [CR-UM].

The layout of the commands and reports of the PUS Extension is defined in the CORDET Editor. The CORDET Editor is a proprietary tool of P\&P Software GmbH which allows the PUS-compliant commands and reports of a set communicating applications to be specified in terms of:

\begin{itemize}
\item The set of supported services 
\item The set of commands and reports in each service
\item The layout of the commands and reports 
\item The semantics of the commands and reports
\item The syntactical type of the parameters in the commands and reports
\item The endianity of the representation of the command and report parameters
\end{itemize}

The CORDET Editor tool includes a suite of generators which can generate the following items:

\begin{itemize}
\item Tables listing the services supporting the commands and reports
\item Tables listing the commands and reports in each service
\item Tables describing the semantics of the commands and reports 
\item Tables defining the layout of each command or report
\item Tables listing the items in the on-board data pool
\item Tables describing the service 5 event identifiers 
\item Tables describing the service 1 command rejection codes 
\item C-language modules implementing the data pool
\item A C-language header file defining the types used for the commands and reports
\item C-language modules implementing accessor methods for the parameters of commands and reports
\end{itemize}

The tables are generated in csv and latex formats. All the tables presented in this document were generated by the CORDET Editor. They are therefore guaranteed to be consistent with the C-language implementation of the PUS Extension. 

The command and report interfaces defined in this document are based on the PUS specification of reference [PS-SP]. This specification leaves some choices open concerning, in particular, the syntactical type of the command and report parameters. These choices have been resolved when the commands and reports were defined in the CORDET Editor. These choices are those used for the Test Suite Application of the C-language implementation of the PUS Extension of the CORDET Framework (see section TBD of reference [PX-UM]). This Test Suite Application is one particular instantiation of the PUS Extension of the CORDET Framework. Users who wish to adapt the present document to a different instantiation (e.g. by changing the size of certain command or report parameters) should proceed as follows:

\begin{itemize}
\item Modify the definition of the commands and reports within the CORDET Editor
\item Run the generator of the CORDET Editor
\item Re-compile this document using the newly generated tables for the commands and reports
\item Re-compile the framework code using the newly generate C-modules implementing the commands and reports
\end{itemize}

%==========================================================================================
\section{Command and Report Packet Structure}\label{sec:PcktStructure}
Command and report packets consist of a header, an application part and a packet error control part. 

The layouts of the command and report headers (packet headers plus data field header) are defined in tables \ref{tab:TCHeader} and \ref{tab:TMHeader}. In the CORDET Editor, these layouts can be modified in the "TC Header" and "TM Header" tables.

The Packet Error Control is implemented as a 2-byte CRC. In the CORDET Editor, the size of the CRC is defined in the "extension" menu of the "packet access functions".

A dummy implementation for the CRC is currently provided which sets it to 0xFFFF. The computation of the CRC is one of the adaptation points of the PUS Extension of the CORDET Framework (adaptation point OST-13) and users are expected to modify it to suit their needs.

The maximum length of a command or report packet is given by constant CR\_FW\_MAX\_PCKT\_LENGTH defined in \texttt{CrFwUserConstants.h}. Note that, in the Test Suite Application, the maximum packet size has been chosen to be unrealistically small in order to allow convenient verification of situations where a certain piece of information must be spread over multiple packets.

For the APID, the following considerations apply (see also section \ref{sec:mapGroup} of reference [PX-SP]):

\begin{itemize}
\item The APID consists of the concatenation of PCAT and PID
\item The PCAT is the same as the CORDET Group attribute 
\item The PID is the same as the CORDET Application Identifier whose value is defined by constant CR\_FW\_HOST\_APP\_ID in \texttt{CrFwUserConstants.h}
\end{itemize}

The PCAT is not defined at framework level. Applications define their PCAT implicitly by implenting functions \texttt{CrFwPcktSetGroup} and \texttt{CrFwPcktGetGroup} in interface \texttt{CrFwPckt.h}.

 
\printTCHeader{|p{3cm}|l|l|l|l|p{5.5cm}|}

\printTMHeader{|p{3cm}|l|l|l|l|p{5.5cm}|}


%==========================================================================================
\section{Service Overview}
Table \ref{tab:listOfServices} lists the services supported by the PUS Extension of the CORDET Framework and table \ref{tab:listOfCmdRep} lists the commands and reports supported in each service.

\pnpcsvtable{|c|c|p{6cm}|}{List of Supported Services}{tab:listOfServices}{Type & Acron. & Name}{../pus/GeneratedTables/PUSExtensionServices.csv}{\Type & \Name & \Description}

\newpage
\pnpcsvtable{|c|l|p{7cm}|}{List of Supported Commands/Reports}{tab:listOfCmdRep}{Type & CORDET Name & PUS Name}{../pus/GeneratedTables/PUSExtensionServiceOverview.csv}{\Type & \Name & \Description}

%==========================================================================================
\begin{landscape}
\section{Detailed Definition of PUS Services}
This section describes the content of all the commands and reports supported by the PUS Extension of the CORDET Framework Software. Each command or report is described in a dedicated table which lists the parameters in the command or report body (the structure of their headers is described in section \ref{sec:PcktStructure}).

\import{./GeneratedTables/}{CrPsPacketDetails}

%==========================================================================================
\section{Data Pool Definition}
The data pool is split into two parts of which one holds the variables and the other holds the parameters. The first two tables in this section list, respectively, the data pool variables and the data pool parameters. The last table lists the constants and their values (some of these constants are used to express the multiplicity of variables or parameters in the data pool).

\printDatapoolParameters{|l|l|p{5cm}|l|l|l|}
\newpage
\printDatapoolVariables{|l|l|p{5cm}|l|l|l|}
\newpage 
\pnpcsvtable{|p{3cm}|>{\raggedright\arraybackslash}p{14cm}|c|}{Constants in the PUS Extension of the CORDET Framework}{tab:Const}{Name & Description & Value}{../pus/GeneratedTables/Constants.csv}{\texttt{\Name} & \Desc & \Value}

%==========================================================================================
\section{Type Definition}
The table in this section defines the data types used by the PUS Extension of the CORDET Framework. For enumerated types, the list of enumerated values and their description is given.

\printTypes{|l|p{13cm}|l|}


\end{landscape}


\end{document}